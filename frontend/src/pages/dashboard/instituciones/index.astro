---
import DashboardLayout from '@/modules/dashboard/core/layouts/DashboardLayout.astro';
import { authService } from '@/modules/auth/core/services/auth';
import { LANDING_ROUTE } from '@/modules/landing/core/lib/routes';
import Button from '@/modules/core/ui/button.astro';
import InstitutionListServer from '@/modules/dashboard/instituciones/core/components/InstitutionListServer.astro';
import InstitutionListSkeleton from '@/modules/dashboard/instituciones/core/components/InstitutionListSkeleton.astro';

// Primero se verifica la autenticación
const { data: user, error } = await authService(Astro.cookies).getUser();

if (error) {
  return Astro.redirect(LANDING_ROUTE.fullPath);
}
---
<DashboardLayout user={user}>
  <!-- Aquí se haría la petición de las instituciones por medio del user id (o token de sesión) en una isla del servidor -->
  <div class="min-h-full flex-1 flex flex-col justify-between py-4 gap-2">
    <InstitutionListServer user={user} server:defer>
      <InstitutionListSkeleton slot="fallback"/>
    </InstitutionListServer>
    <!-- <Button>
      Crear otra institución
    </Button> -->
  </div>
</DashboardLayout>
